class Point{constructor(t=0,e=0){this.X=t,this.Y=e}}class Boundary{constructor(){this.left=0,this.right=0,this.top=0,this.left=0}}let Candas=function(){return this.isNumber=function(t){return"number"==typeof t&&isFinite(t)},this.OnlyFloat=function(t,e=null,o=null){/^-?\d*[.,]?\d*$/.test(t.value)?(null!=e&&t.value>e&&(t.value=e),null!=o&&parseFloat(t.value)<o&&(t.value=o),t.oldValue=t.value,t.oldSelectionStart=t.selectionStart,t.oldSelectionEnd=t.selectionEnd):t.hasOwnProperty("oldValue")?(t.value=t.oldValue,t.setSelectionRange(t.oldSelectionStart,t.oldSelectionEnd)):t.value=""},this};candas=new Candas,candas.Pyhsics=function(t){var e={onupdate:function(){},onload:function(){},centroid_axis_color:"#0066cc",boundary_axis_color:"#ff0033",world_cords_color:"#bbbbbb",color_threshold:130,color_invert:!1,plotter_width:400,...t},o=this,a=new Image,r=!1,i=document.createElement("canvas"),n=i.getContext("2d"),l=null,d=document.createElement("canvas"),h=i.getContext("2d"),s=null,c=null,u=new FileReader,_=new Point,m=new Point,g=new Point;let p={pipe_diameter:2500,profile_thickness:1,profile_width:120,data_youngmod_short:800,data_material_density:.949};function f(t,o){t.translate(.5,.5),t.beginPath(),t.lineWidth=1,t.strokeStyle=e.world_cords_color,t.moveTo(10,o-10),t.lineTo(50,o-10),t.moveTo(10,o-10),t.lineTo(10,o-50),t.stroke(),t.font="12px Arial",t.fillStyle=e.world_cords_color,t.fillText("X",55,o-7),t.fillText("Y",7,o-55),t.translate(-.5,-.5)}function w(t,e){let o=Number(0),a=0;if(e>0&&t.length>0){for(let r=e;r>=0;r--)o+=p.profile_thickness*t[r]*a**2,a++;a=0;for(let r=e;r<t.length;r++)o+=p.profile_thickness*t[r]*a**2,a++}else o=0;return o}function v(){if(!r)return!1;let t=new Point,o=new Boundary,i=0,n=new Point,u=document.createElement("canvas"),m=u.getContext("2d"),v=null,X=clravr=b=color_w=color_b=0;rs_imgdata=h.getImageData(0,0,d.width,d.height),color_w=e.color_invert?0:255,color_b=255-color_w,n.X=n.Y=0,o.left=_.X,o.top=_.Y,o.bottom=o.right=0;for(var Y=0;Y<_.Y;Y++)for(var y=0;y<_.X;y++)b=4*Y*_.X+4*y,clravr=(l.data[b]+l.data[b+1]+l.data[b+2])/3,clravr=clravr<e.color_threshold?color_b:color_w,0==clravr&&(y<o.left&&(o.left=y),y>o.right&&(o.right=y),Y<o.top&&(o.top=Y),Y>o.bottom&&(o.bottom=Y),n.X+=y,n.Y+=Y,i++);o.left>=o.right&&(o.left=0,o.right=0),o.top>=o.bottom&&(o.top=0,o.bottom=0);for(var b=0;b<rs_imgdata.data.length;b+=4)clravr=(rs_imgdata.data[b]+rs_imgdata.data[b+1]+rs_imgdata.data[b+2])/3,clravr=clravr<e.color_threshold?color_b:color_w,rs_imgdata.data[b]=rs_imgdata.data[b+1]=rs_imgdata.data[b+2]=0==clravr?0:255;0!=i?(n.X/=i,n.Y/=i):(n.X=0,n.Y=0),c.clearRect(0,0,s.width,s.height),c.putImageData(rs_imgdata,0,0);const T={X:[],Y:[]};if(X=0,u.width=p.profile_width,u.height=p.profile_width*(o.bottom-o.top)/(o.right-o.left),0==u.width||0==u.height)X=0,t.X=0,t.Y=0,e.onupdate.call(this,{source:{centroid:new Point(0,0),area:0,boundary:new Boundary},extracted:{centroid:new Point(0,0),area:0,height:0,moi:{lxx:0,lyy:0},sr:0,sn:0},pipe:{inner_diameter:0,outer_diameter:0,mean_radius:0,mass:0}}),f(c,s.height);else{m.clearRect(0,0,s.width,s.height),m.drawImage(a,o.left,o.top,o.right-o.left,o.bottom-o.top,0,0,u.width,u.height),v=m.getImageData(0,0,u.width,u.height),T.X=new Array(u.width);for(let t=0;t<u.width;++t)T.X[t]=0;T.Y=new Array(u.height);for(let t=0;t<u.height;++t)T.Y[t]=0;for(Y=0;Y<u.height;Y++)for(y=0;y<u.width;y++)b=4*Y*u.width+4*y,clravr=(v.data[b]+v.data[b+1]+v.data[b+2])/3,clravr=clravr<e.color_threshold?color_b:color_w,0==clravr&&(t.X+=y,t.Y+=Y,X++,T.X[y]+=1,T.Y[Y]+=1);0!=X?(t.X/=X,t.Y/=X):(t.X=0,t.Y=0);let r=[];r[0]=w(T.Y,~~t.Y),r[1]=w(T.X,~~t.X),r[2]=p.profile_width*(o.bottom-o.top)/(o.right-o.left),r[3]=p.pipe_diameter/2+(r[2]-t.Y),t.Y=r[2]-t.Y,e.onupdate.call(this,{source:{centroid:n,area:i,boundary:o},extracted:{centroid:t,area:X,height:r[2],moi:{lxx:r[0],lyy:r[1]},sr:r[0]/100*p.data_youngmod_short/(p.pipe_diameter/2/100)**3,sn:r[0]/100*p.data_youngmod_short/(p.pipe_diameter/2/100)**3/8},pipe:{inner_diameter:p.pipe_diameter,outer_diameter:p.pipe_diameter+2*r[2],mean_radius:r[3],mass:2*r[3]*Math.PI/p.profile_width*(X*p.data_material_density/1e3)*1e3}}),n.X>0&&n.Y>0?(c.translate(.5,.5),c.beginPath(),c.lineWidth=1,c.strokeStyle=e.centroid_axis_color,c.moveTo(0,~~(n.Y*g.Y)),c.lineTo(s.width,~~(n.Y*g.Y)),c.moveTo(~~(n.X*g.X),0),c.lineTo(~~(n.X*g.X),s.height),c.stroke(),c.beginPath(),c.lineWidth=1,c.strokeStyle=e.boundary_axis_color,c.moveTo(~~(o.left*g.X),0),c.lineTo(~~(o.left*g.X),s.height),c.moveTo(~~(o.right*g.X),0),c.lineTo(~~(o.right*g.X),s.height),c.stroke(),c.beginPath(),c.lineWidth=1,c.strokeStyle=e.boundary_axis_color,c.moveTo(0,~~(o.top*g.Y)),c.lineTo(s.width,~~(o.top*g.Y)),c.moveTo(0,~~(o.bottom*g.Y)),c.lineTo(s.width,~~(o.bottom*g.Y)),c.stroke(),c.translate(-.5,-.5),f(c,s.height)):f(c,s.height)}}function X(t,e,a){if(t=parseFloat(t),!(o.isNumber(t)&&t>a.min&&t<=a.max))throw new Error("Invalid input");p[e]=t}return a.crossOrigin="Anonymous",a.addEventListener("load",(function(){r=!0,_.X=a.width,_.Y=a.height,i.width=m.X=_.X,i.height=m.Y=_.Y,n.drawImage(a,0,0),l=n.getImageData(0,0,_.X,_.Y),c.clearRect(0,0,_.X,_.Y),_.X>e.plotter_width?(m.Y*=e.plotter_width/_.X,m.X=e.plotter_width,g.X=m.X/_.X,g.Y=m.Y/_.Y,s.width=d.width=m.X,s.height=d.height=m.Y):(g.X=g.Y=1,s.width=d.width=_.X,s.height=d.height=_.Y),h.drawImage(a,0,0,d.width,d.height),e.onload.call(this,{inputsize:_}),v()}),!0),u.onload=function(t){a.src=t.target.result},{param:{set YoungModulus_short(t){X(t,"data_youngmod_short",{min:0,max:2e3})},set ProfileWidth(t){X(t,"profile_width",{min:0,max:2e3})},set ProfileThickness(t){X(t,"profile_thickness",{min:0,max:100})},set PipeDiameter(t){X(t,"pipe_diameter",{min:0,max:1e4})},set MaterialDensity(t){X(t,"data_material_density",{min:0,max:100})}},ReceiveFile:function(t){u.readAsDataURL(t)},ColorThreshold:function(t){e.color_threshold=~~t},ColorInvert:function(t){e.color_invert=!!t},LoadURL:function(t){a.src=t},Clear:function(){c.clearRect(0,0,s.width,s.height),r=!1},PlotCanvas:function(t){c=(s=t).getContext("2d")},SaveImage:function(){if(!r)return!1;var t=function(t){for(var e=atob(t.split(",")[1]),o=[],a=0;a<e.length;)o.push(e.charCodeAt(a)),a++;return new Uint8Array(o)}(s.toDataURL("image/png")),e=new FormData,o=new XMLHttpRequest;e.append("imagefile",new Blob([t],{type:"image/png"})),e.append("method","saveimage"),o.onreadystatechange=function(){o.readyState==XMLHttpRequest.DONE&&alert(o.responseText)},o.open("POST","<?php echo $app->http_root.$pageinfo['directory'];?>",!0),o.setRequestHeader("HTTP_X_REQUESTED_WITH","XMLHttpRequest"),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.send(e)},Process:function(){v()}}};